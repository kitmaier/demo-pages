<html>
<body>
<svg id="svg" height="600" width="800" xmlns="http://www.w3.org/2000/svg">
</svg>
</body>
<script>
var svg = document.getElementById("svg");

/*

Monkey's Tree fractal from The Fractal Geometry of Nature page 31
TODO: color in the area on one side of the line
TODO: round off the corners

...................
...................
...................
...../0-----0\.....
..../.../0\...\....
.../..0/...\0\.\...
...0..|.......\0...
.../..0.....0......
../...|............
0/....0-----0-----0

*/

var r3 = 1.732

var unitPoints =
 [[0,0],
  [1,3],
  [2,6],
  [4,6],
  [5,3],
  [4,4],
  [3,5],
  [2,4],
  [2,2],
  [2,0],
  [4,0],
  [6,0]]

function normalizeUnitPoints() {
	for(var k=0; k<unitPoints.length; k++) {
		var point = unitPoints[k];
		point[0] = point[0]/6.0;
		point[1] = point[1]*Math.sqrt(3)/18.0;
	}
}

normalizeUnitPoints();

// TODO: there are actually four directions in the book, left vs right side and forward vs back hook
var directions =
 [-1,
   1,
   1,
   1,
   1,
  -1,
  -1,
  -1,
   1,
  -1,
   1]


function paintMonkeysTree(x1,y1,x2,y2,level) {
	// (a+bi)(c+di) = (ac-bd)+(ad+bc)i
	var c = x2-x1;
	var d = y2-y1;
	var transformedPoints = [[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]];
	var hookDirection = Math.floor(Math.random()*2); // TODO: control hook direction externally
	for(var k=0; k<unitPoints.length; k++) {
		var a = unitPoints[k][0];
		var b = unitPoints[k][1];
		if(hookDirection==0) {
			transformedPoints[k][0] = a*c-b*d+x1;
			transformedPoints[k][1] = a*d+b*c+y1;
		} else {
			transformedPoints[k][0] = (1.0-a)*c-b*d+x1;
			transformedPoints[k][1] = (1.0-a)*d+b*c+y1;
		}
	}
	for(var k=0; k<transformedPoints.length-1; k++) {
		var p1 = transformedPoints[k];
		var p2 = transformedPoints[k+1];
		if(level==0) {
			var line = document.createElementNS("http://www.w3.org/2000/svg", "line");
			line.setAttribute("style", "stroke:black;stroke-width:1");
			svg.appendChild(line);
			line.setAttribute("x1",p1[0]);
			line.setAttribute("y1",p1[1]);
			line.setAttribute("x2",p2[0]);
			line.setAttribute("y2",p2[1]);
		} else {
			var direction = directions[k];
			if(hookDirection==1) {
				direction = -1*direction // TODO: clean this up
			}
			if(direction==1) {
				paintMonkeysTree(p1[0],p1[1],p2[0],p2[1],level-1);
			} else {
				paintMonkeysTree(p2[0],p2[1],p1[0],p1[1],level-1);
			}
		}
	}
}

paintMonkeysTree(150,150,600,150,1);

</script>
</html>
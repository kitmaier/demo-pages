<html>
<body>
<button type="button" onclick ="buttonClick1()">Click Me!</button>
<button type="button" onclick ="buttonClick2()">Click Me!</button>
<select id="numberSelect" name="selectedNumber" onchange="selectNumber()">
  <option value="0">0</option>
  <option value="1" selected>1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
</select>
<svg id="svg" height="600" width="800" xmlns="http://www.w3.org/2000/svg">
</svg>
</body>
<script>
var svg = document.getElementById("svg");

/*

Monkey's Tree fractal from The Fractal Geometry of Nature page 31
TODO: round off the corners
TODO: add button to rerun the random generation with a new seed
TODO: add user input to control number of stages of generation

...................
...................
...................
...../0-----0\.....
..../.../0\...\....
.../..0/...\0\.\...
...0..|.......\0...
.../..0.....0......
../...|............
0/....0-----0-----0

*/

var unitPoints =
 [[0,0],
  [1,3],
  [2,6],
  [4,6],
  [5,3],
  [4,4],
  [3,5],
  [2,4],
  [2,2],
  [2,0],
  [4,0],
  [6,0]]

function normalizeUnitPoints() {
	for(var k=0; k<unitPoints.length; k++) {
		var point = unitPoints[k];
		point[0] = point[0]/6.0;
		point[1] = point[1]*Math.sqrt(3)/18.0;
	}
}

normalizeUnitPoints();

var polygon = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
polygon.setAttribute("style", "fill:black;stroke:black;stroke-width:0");
//polygon.setAttribute("style", "fill:white;stroke:black;stroke-width:1");
svg.appendChild(polygon);
var polygonColor = "black";
var iterationLevel = 1;

function appendPoint(x,y) {
	var point = svg.createSVGPoint();
	point.x = x;
	point.y = y;
	polygon.points.appendItem(point);
}

function buttonClick1() {
	if(polygon.style.fill=="black") {
		polygon.style.fill = "white";
		polygon.style.strokeWidth = 1;
		polygonColor = "white";
	} else {
		polygon.style.fill = "black";
		polygon.style.strokeWidth = 0;
		polygonColor = "black";
	}
}

// TODO: there are actually four directions in the book, left vs right side and forward vs back hook
var directions =
 [-1,
   1,
   1,
   1,
   1,
  -1,
  -1,
  -1,
   1,
  -1,
   1]


function paintMonkeysTree(x1,y1,x2,y2,level,direction) {
	// (a+bi)(c+di) = (ac-bd)+(ad+bc)i
	var c = x2-x1;
	var d = y2-y1;
	var transformedPoints = [[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]];
	var hookDirection = Math.floor(Math.random()*2); // TODO: control hook direction externally
	for(var k=0; k<unitPoints.length; k++) {
		var k2 = k;
		var a = unitPoints[k][0];
		var b = unitPoints[k][1];
		if(hookDirection==1) {
			a = 1.0-a;
			k2 = unitPoints.length-1-k;
		}
		if(direction==-1) {
			b = -b;
		}
		transformedPoints[k2][0] = a*c-b*d+x1;
		transformedPoints[k2][1] = a*d+b*c+y1;
	}
	for(var k=0; k<transformedPoints.length-1; k++) {
		var p1 = transformedPoints[k];
		var p2 = transformedPoints[k+1];
		if(level==0) {
			appendPoint(p2[0],p2[1]);
		} else {
			var k2 = hookDirection==1?directions.length-1-k:k;
			var childDirection = directions[k2]*direction;
			paintMonkeysTree(p1[0],p1[1],p2[0],p2[1],level-1,childDirection);
		}
	}
}

function paintMonkeysTreeAndBox() {
	appendPoint(600,150);
	appendPoint(800,150);
	appendPoint(800,0);
	appendPoint(0,0);
	appendPoint(0,150);
	appendPoint(150,150);
	paintMonkeysTree(150,150,600,150,iterationLevel,1);
}

paintMonkeysTreeAndBox();

function buttonClick2() {
	polygon.remove();
	polygon = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
	polygon.style.stroke = "black";
	if(polygonColor=="black") {
		polygon.style.fill = "black";
		polygon.style.strokeWidth = 0;
	} else {
		polygon.style.fill = "white";
		polygon.style.strokeWidth = 1;
	}
	svg.appendChild(polygon);
	paintMonkeysTreeAndBox();
}

function selectNumber() {
	iterationLevel = document.getElementById("numberSelect").value;
	buttonClick2();
}


</script>
</html>